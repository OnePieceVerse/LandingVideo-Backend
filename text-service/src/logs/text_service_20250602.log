2025-06-02 18:22:52,024 [INFO] 启动URL爬取和处理服务在 0.0.0.0:8000...
2025-06-02 18:22:52,041 [INFO] Started server process [22259]
2025-06-02 18:22:52,042 [INFO] Waiting for application startup.
2025-06-02 18:22:52,042 [INFO] Application startup complete.
2025-06-02 18:22:52,042 [INFO] Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
2025-06-02 18:28:45,927 [INFO] Shutting down
2025-06-02 18:28:46,035 [INFO] Waiting for application shutdown.
2025-06-02 18:28:46,037 [INFO] Application shutdown complete.
2025-06-02 18:28:46,037 [INFO] Finished server process [22259]
2025-06-02 18:28:49,741 [INFO] 启动URL爬取和处理服务在 0.0.0.0:8000...
2025-06-02 18:28:49,755 [INFO] Started server process [32696]
2025-06-02 18:28:49,755 [INFO] Waiting for application startup.
2025-06-02 18:28:49,755 [INFO] Application startup complete.
2025-06-02 18:28:49,756 [INFO] Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
2025-06-02 18:32:22,059 [INFO] [req_1748860342059] 开始处理URL: https://cfm.qq.com/web201801/detail.shtml?docid=18193320012779363519
2025-06-02 18:32:22,060 [INFO] [req_1748860342059] 步骤1/4: 发送爬取请求
2025-06-02 18:32:22,060 [INFO] 开始爬取URL: https://cfm.qq.com/web201801/detail.shtml?docid=18193320012779363519
2025-06-02 18:32:22,071 [INFO] 发送请求到: http://9.134.132.205:3002/v1/crawl
2025-06-02 18:32:22,839 [INFO] 爬取请求成功，任务ID: 6eff7546-a08d-41bd-8e22-0dd99d9cb6e9
2025-06-02 18:32:22,840 [INFO] [req_1748860342059] 步骤2/4: 获取爬取结果
2025-06-02 18:32:22,840 [INFO] 开始获取爬取结果，URL: http://9.134.132.205:3002/v1/crawl/6eff7546-a08d-41bd-8e22-0dd99d9cb6e9
2025-06-02 18:32:24,340 [INFO] 爬取任务已完成
2025-06-02 18:32:24,341 [INFO] [req_1748860342059] 步骤3/4: 使用OpenAI处理数据
2025-06-02 18:32:24,342 [INFO] 开始使用OpenAI moonshot-v1-8k 处理数据
2025-06-02 18:32:24,343 [INFO] 预估输入token数: 2371
2025-06-02 18:32:24,431 [INFO] 尝试 1/3: 发送请求到OpenAI API
2025-06-02 18:32:49,374 [INFO] HTTP Request: POST https://api.moonshot.cn/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-02 18:32:49,393 [INFO] Token使用 - 输入: 2371, 输出: 1961
2025-06-02 18:32:49,393 [INFO] 预估成本: ¥0.0244
2025-06-02 18:32:49,393 [INFO] 成功解析JSON响应
2025-06-02 18:32:49,393 [INFO] [req_1748860342059] 步骤4/4: 格式化API响应
2025-06-02 18:32:49,393 [INFO] 格式化API响应
2025-06-02 18:32:49,393 [INFO] [req_1748860342059] URL处理完成，总耗时: 27.33 秒
2025-06-02 18:32:49,395 [INFO] 127.0.0.1:63767 - "GET /api/v1/text/urlCrawl?url=https://cfm.qq.com/web201801/detail.shtml?docid=18193320012779363519 HTTP/1.1" 200
2025-06-02 18:41:51,939 [INFO] Shutting down
2025-06-02 18:41:52,046 [INFO] Waiting for application shutdown.
2025-06-02 18:41:52,047 [INFO] Application shutdown complete.
2025-06-02 18:41:52,047 [INFO] Finished server process [32696]
2025-06-02 18:41:58,389 [INFO] 启动URL爬取和处理服务在 0.0.0.0:8000...
2025-06-02 18:41:58,403 [INFO] Started server process [56353]
2025-06-02 18:41:58,404 [INFO] Waiting for application startup.
2025-06-02 18:41:58,404 [INFO] Application startup complete.
2025-06-02 18:41:58,404 [INFO] Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
2025-06-02 18:42:01,135 [INFO] [req_1748860921134] 开始处理URL: https://cfm.qq.com/web201801/detail.shtml?docid=18193320012779363519
2025-06-02 18:42:01,135 [INFO] [req_1748860921134] 步骤1/4: 发送爬取请求
2025-06-02 18:42:01,136 [INFO] 开始爬取URL: https://cfm.qq.com/web201801/detail.shtml?docid=18193320012779363519
2025-06-02 18:42:01,141 [INFO] 发送请求到: http://localhost:3002/v1/crawl
2025-06-02 18:42:01,181 [ERROR] 爬取请求发生异常: HTTPConnectionPool(host='localhost', port=3002): Max retries exceeded with url: /v1/crawl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x107d33370>: Failed to establish a new connection: [Errno 61] Connection refused'))
Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connection.py", line 174, in _new_conn
    conn = connection.create_connection(
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/util/connection.py", line 95, in create_connection
    raise err
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/util/connection.py", line 85, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connectionpool.py", line 716, in urlopen
    httplib_response = self._make_request(
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connectionpool.py", line 416, in _make_request
    conn.request(method, url, **httplib_request_kw)
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connection.py", line 244, in request
    super(HTTPConnection, self).request(method, url, body=body, headers=headers)
  File "/opt/homebrew/Cellar/python@3.9/3.9.21/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1285, in request
    self._send_request(method, url, body, headers, encode_chunked)
  File "/opt/homebrew/Cellar/python@3.9/3.9.21/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1331, in _send_request
    self.endheaders(body, encode_chunked=encode_chunked)
  File "/opt/homebrew/Cellar/python@3.9/3.9.21/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1280, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/opt/homebrew/Cellar/python@3.9/3.9.21/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1040, in _send_output
    self.send(msg)
  File "/opt/homebrew/Cellar/python@3.9/3.9.21/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 980, in send
    self.connect()
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connection.py", line 205, in connect
    conn = self._new_conn()
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connection.py", line 186, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x107d33370>: Failed to establish a new connection: [Errno 61] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.9/site-packages/requests/adapters.py", line 486, in send
    resp = conn.urlopen(
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connectionpool.py", line 802, in urlopen
    retries = retries.increment(
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/util/retry.py", line 594, in increment
    raise MaxRetryError(_pool, url, error or ResponseError(cause))
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=3002): Max retries exceeded with url: /v1/crawl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x107d33370>: Failed to establish a new connection: [Errno 61] Connection refused'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/123jiaru/Desktop/project/tencent_work/python/LandingVideo-Backend/text-service/src/core/service/crawler_service.py", line 37, in crawl_url
    response = requests.post(
  File "/opt/homebrew/lib/python3.9/site-packages/requests/api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
  File "/opt/homebrew/lib/python3.9/site-packages/requests/api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
  File "/opt/homebrew/lib/python3.9/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "/opt/homebrew/lib/python3.9/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "/opt/homebrew/lib/python3.9/site-packages/requests/adapters.py", line 519, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=3002): Max retries exceeded with url: /v1/crawl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x107d33370>: Failed to establish a new connection: [Errno 61] Connection refused'))
2025-06-02 18:42:01,188 [ERROR] [req_1748860921134] 处理失败: 
2025-06-02 18:42:01,188 [INFO] 127.0.0.1:65111 - "GET /api/v1/text/urlCrawl?url=https://cfm.qq.com/web201801/detail.shtml?docid=18193320012779363519 HTTP/1.1" 500
2025-06-02 18:43:07,097 [INFO] [req_1748860987097] 开始处理URL: https://cfm.qq.com/web201801/detail.shtml?docid=18193320012779363519
2025-06-02 18:43:07,098 [INFO] [req_1748860987097] 步骤1/4: 发送爬取请求
2025-06-02 18:43:07,098 [INFO] 开始爬取URL: https://cfm.qq.com/web201801/detail.shtml?docid=18193320012779363519
2025-06-02 18:43:07,098 [INFO] 发送请求到: http://localhost:3002/v1/crawl
2025-06-02 18:43:07,107 [ERROR] 爬取请求发生异常: HTTPConnectionPool(host='localhost', port=3002): Max retries exceeded with url: /v1/crawl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x118819100>: Failed to establish a new connection: [Errno 61] Connection refused'))
Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connection.py", line 174, in _new_conn
    conn = connection.create_connection(
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/util/connection.py", line 95, in create_connection
    raise err
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/util/connection.py", line 85, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connectionpool.py", line 716, in urlopen
    httplib_response = self._make_request(
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connectionpool.py", line 416, in _make_request
    conn.request(method, url, **httplib_request_kw)
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connection.py", line 244, in request
    super(HTTPConnection, self).request(method, url, body=body, headers=headers)
  File "/opt/homebrew/Cellar/python@3.9/3.9.21/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1285, in request
    self._send_request(method, url, body, headers, encode_chunked)
  File "/opt/homebrew/Cellar/python@3.9/3.9.21/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1331, in _send_request
    self.endheaders(body, encode_chunked=encode_chunked)
  File "/opt/homebrew/Cellar/python@3.9/3.9.21/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1280, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/opt/homebrew/Cellar/python@3.9/3.9.21/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1040, in _send_output
    self.send(msg)
  File "/opt/homebrew/Cellar/python@3.9/3.9.21/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 980, in send
    self.connect()
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connection.py", line 205, in connect
    conn = self._new_conn()
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connection.py", line 186, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x118819100>: Failed to establish a new connection: [Errno 61] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.9/site-packages/requests/adapters.py", line 486, in send
    resp = conn.urlopen(
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connectionpool.py", line 802, in urlopen
    retries = retries.increment(
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/util/retry.py", line 594, in increment
    raise MaxRetryError(_pool, url, error or ResponseError(cause))
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=3002): Max retries exceeded with url: /v1/crawl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x118819100>: Failed to establish a new connection: [Errno 61] Connection refused'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/123jiaru/Desktop/project/tencent_work/python/LandingVideo-Backend/text-service/src/core/service/crawler_service.py", line 37, in crawl_url
    response = requests.post(
  File "/opt/homebrew/lib/python3.9/site-packages/requests/api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
  File "/opt/homebrew/lib/python3.9/site-packages/requests/api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
  File "/opt/homebrew/lib/python3.9/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "/opt/homebrew/lib/python3.9/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "/opt/homebrew/lib/python3.9/site-packages/requests/adapters.py", line 519, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=3002): Max retries exceeded with url: /v1/crawl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x118819100>: Failed to establish a new connection: [Errno 61] Connection refused'))
2025-06-02 18:43:07,120 [ERROR] [req_1748860987097] 处理失败: 
2025-06-02 18:43:07,120 [INFO] 127.0.0.1:65340 - "GET /api/v1/text/urlCrawl?url=https://cfm.qq.com/web201801/detail.shtml?docid=18193320012779363519 HTTP/1.1" 500
2025-06-02 18:46:00,442 [INFO] [req_1748861160442] 开始处理URL: https://cfm.qq.com/web201801/detail.shtml?docid=18193320012779363519
2025-06-02 18:46:00,443 [INFO] [req_1748861160442] 步骤1/4: 发送爬取请求
2025-06-02 18:46:00,443 [INFO] 开始爬取URL: https://cfm.qq.com/web201801/detail.shtml?docid=18193320012779363519
2025-06-02 18:46:00,443 [INFO] 发送请求到: http://localhost:3002/v1/crawl
2025-06-02 18:46:00,452 [ERROR] 爬取请求发生异常: HTTPConnectionPool(host='localhost', port=3002): Max retries exceeded with url: /v1/crawl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x118823400>: Failed to establish a new connection: [Errno 61] Connection refused'))
Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connection.py", line 174, in _new_conn
    conn = connection.create_connection(
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/util/connection.py", line 95, in create_connection
    raise err
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/util/connection.py", line 85, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connectionpool.py", line 716, in urlopen
    httplib_response = self._make_request(
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connectionpool.py", line 416, in _make_request
    conn.request(method, url, **httplib_request_kw)
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connection.py", line 244, in request
    super(HTTPConnection, self).request(method, url, body=body, headers=headers)
  File "/opt/homebrew/Cellar/python@3.9/3.9.21/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1285, in request
    self._send_request(method, url, body, headers, encode_chunked)
  File "/opt/homebrew/Cellar/python@3.9/3.9.21/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1331, in _send_request
    self.endheaders(body, encode_chunked=encode_chunked)
  File "/opt/homebrew/Cellar/python@3.9/3.9.21/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1280, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/opt/homebrew/Cellar/python@3.9/3.9.21/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1040, in _send_output
    self.send(msg)
  File "/opt/homebrew/Cellar/python@3.9/3.9.21/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 980, in send
    self.connect()
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connection.py", line 205, in connect
    conn = self._new_conn()
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connection.py", line 186, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x118823400>: Failed to establish a new connection: [Errno 61] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.9/site-packages/requests/adapters.py", line 486, in send
    resp = conn.urlopen(
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/connectionpool.py", line 802, in urlopen
    retries = retries.increment(
  File "/opt/homebrew/lib/python3.9/site-packages/urllib3/util/retry.py", line 594, in increment
    raise MaxRetryError(_pool, url, error or ResponseError(cause))
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=3002): Max retries exceeded with url: /v1/crawl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x118823400>: Failed to establish a new connection: [Errno 61] Connection refused'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/123jiaru/Desktop/project/tencent_work/python/LandingVideo-Backend/text-service/src/core/service/crawler_service.py", line 37, in crawl_url
    response = requests.post(
  File "/opt/homebrew/lib/python3.9/site-packages/requests/api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
  File "/opt/homebrew/lib/python3.9/site-packages/requests/api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
  File "/opt/homebrew/lib/python3.9/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "/opt/homebrew/lib/python3.9/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "/opt/homebrew/lib/python3.9/site-packages/requests/adapters.py", line 519, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=3002): Max retries exceeded with url: /v1/crawl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x118823400>: Failed to establish a new connection: [Errno 61] Connection refused'))
2025-06-02 18:46:00,460 [ERROR] [req_1748861160442] 处理失败: 
2025-06-02 18:46:00,461 [INFO] 127.0.0.1:49340 - "GET /api/v1/text/urlCrawl?url=https://cfm.qq.com/web201801/detail.shtml?docid=18193320012779363519 HTTP/1.1" 500
2025-06-02 18:46:08,107 [INFO] Shutting down
2025-06-02 18:46:08,210 [INFO] Waiting for application shutdown.
2025-06-02 18:46:08,210 [INFO] Application shutdown complete.
2025-06-02 18:46:08,210 [INFO] Finished server process [56353]
